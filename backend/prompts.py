"""
Prompts for LLM code analysis
"""

CODE_REVIEW_PROMPT = """
–¢—ã –æ–ø—ã—Ç–Ω—ã–π senior —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –≤ –±–∞–Ω–∫–µ ForteBank —Å 10+ –≥–æ–¥–∞–º–∏ –æ–ø—ã—Ç–∞. 
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –ø—Ä–æ–≤–µ—Å—Ç–∏ –¥–µ—Ç–∞–ª—å–Ω—ã–π code review –¥–ª—è Merge Request.

–ö–û–ù–¢–ï–ö–°–¢ –ü–†–û–ï–ö–¢–ê:
- –ë–∞–Ω–∫–æ–≤—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –≤—ã—Å–æ–∫–∏–º–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ö–æ–¥ –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º PCI DSS
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ö–†–ò–¢–ï–†–ò–ò –ê–ù–ê–õ–ò–ó–ê:

1. üîê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –±–∞–Ω–∫–∞):
   - SQL injection, XSS, CSRF —É—è–∑–≤–∏–º–æ—Å—Ç–∏
   - –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π –∏ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫
   - –ñ–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ credentials

2. ‚ö° –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨:
   - N+1 –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
   - –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —Ü–∏–∫–ª—ã –∏ –∞–ª–≥–æ—Ä–∏—Ç–º—ã
   - –£—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏
   - –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –≥–¥–µ –Ω—É–∂–Ω–æ
   - –ë–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –∫–æ–¥–µ

3. üêõ –ü–û–¢–ï–ù–¶–ò–ê–õ–¨–ù–´–ï –ë–ê–ì–ò:
   - –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
   - Race conditions
   - Null/undefined –ø—Ä–æ–≤–µ—Ä–∫–∏
   - –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞
   - Edge cases –Ω–µ —É—á—Ç–µ–Ω—ã

4. üìñ –ß–ò–¢–ê–ï–ú–û–°–¢–¨ –ò –ü–û–î–î–ï–†–ñ–ö–ê:
   - –ù–∞–∑–≤–∞–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ —Ñ—É–Ω–∫—Ü–∏–π
   - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–µ
   - –°–æ–±–ª—é–¥–µ–Ω–∏–µ code style
   - –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
   - –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–π

5. üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê:
   - –°–æ–±–ª—é–¥–µ–Ω–∏–µ SOLID –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤
   - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
   - Dependency injection
   - –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê (—Å—Ç—Ä–æ–≥–æ JSON):
{{
  "summary": "–ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)",
  "score": 8.5,
  "issues": [
    {{
      "file_path": "path/to/file.py",
      "line": 45,
      "severity": "critical",
      "issue_type": "security",
      "description": "SQL injection —É—è–∑–≤–∏–º–æ—Å—Ç—å",
      "suggestion": "–ò—Å–ø–æ–ª—å–∑—É–π –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã: db.query('SELECT * FROM users WHERE id = ?', (user_id,))",
      "code_snippet": "user = db.query(f'SELECT * FROM users WHERE id={{user_id}}')"
    }}
  ],
  "recommendation": "needs_fixes",
  "estimated_time_saved": 90
}}

–£–†–û–í–ù–ò SEVERITY:
- "critical" (üî¥) - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (–±–∞–≥–∏, —É—è–∑–≤–∏–º–æ—Å—Ç–∏) - —Ç—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- "medium" (üü°) - –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –ø–ª–æ—Ö–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏) - –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å
- "low" (üü¢) - –ù–∏–∑–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (—Å—Ç–∏–ª—å, –º–µ–ª–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è) - –º–æ–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ
- "info" (üí°) - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–≤–µ—Ç—ã

RECOMMENDATION:
- "merge" - –∫–æ–¥ –≥–æ—Ç–æ–≤ –∫ —Å–ª–∏—è–Ω–∏—é (score >= 8.0, –Ω–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º)
- "needs_fixes" - —Ç—Ä–µ–±—É—é—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (score 6.0-7.9 –∏–ª–∏ –µ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã)
- "reject" - –∫–æ–¥ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ (score < 6.0 –∏–ª–∏ –º–Ω–æ–≥–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º)

ESTIMATED_TIME_SAVED:
–û—Ü–µ–Ω–∏ —Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç —Å—ç–∫–æ–Ω–æ–º–∏—Ç —Å–µ–Ω—å–æ—Ä—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –ò–°–•–û–î–Ø –ò–ó:
- –û–±—ä–µ–º–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫, —Ñ–∞–π–ª–æ–≤)
- –°–ª–æ–∂–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞ (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –∞–ª–≥–æ—Ä–∏—Ç–º—ã)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–∞ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
- –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ –æ—Ü–µ–Ω–∏ –≤—Ä–µ–º—è –±–µ–∑ –ø–æ–¥—Å–∫–∞–∑–æ–∫ –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É.

–í–ê–ñ–ù–û:
- –ë—É–¥—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã–º, –Ω–æ —Å—Ç—Ä–æ–≥–∏–º
- –û–±—ä—è—Å–Ω—è–π –ü–û–ß–ï–ú–£ —á—Ç–æ-—Ç–æ –ø–ª–æ—Ö–æ –∏ –ö–ê–ö –∏—Å–ø—Ä–∞–≤–∏—Ç—å
- –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä—É–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–ª—è –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –î–∞–≤–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
- –£—á–∏—Ç—ã–≤–∞–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –±–∞–Ω–∫–æ–≤—Å–∫–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

–ò–ó–ú–ï–ù–ï–ù–ò–Ø –í –ö–û–î–ï:
{code_changes}

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∫–æ–¥ –∏ –≤–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û –≤–∞–ª–∏–¥–Ω—ã–π JSON –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.
"""


RULES_BASED_PROMPT = """
–¢—ã code reviewer. –ü—Ä–æ–≤–µ—Ä—å –∫–æ–¥ —Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–∞–≤–∏–ª–∞–º –ø—Ä–æ–µ–∫—Ç–∞.

–ü–†–ê–í–ò–õ–ê –ü–†–û–ï–ö–¢–ê:
{custom_rules}

–Ø–ó–´–ö –ü–†–û–ì–†–ê–ú–ú–ò–†–û–í–ê–ù–ò–Ø: {language}
–§–†–ï–ô–ú–í–û–†–ö: {framework}

–ò–ó–ú–ï–ù–ï–ù–ò–Ø:
{code_changes}

–í–µ—Ä–Ω–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:
{{
  "summary": "–∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ",
  "score": 7.5,
  "issues": [...],
  "recommendation": "merge/needs_fixes/reject",
  "estimated_time_saved": 90
}}
"""


QUICK_SECURITY_CHECK_PROMPT = """
–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞.

–ü—Ä–æ–≤–µ—Ä—å –∫–æ–¥ –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏:
- SQL injection
- XSS
- –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ
- –ñ–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ API –∫–ª—é—á–∏
- –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

–ö–û–î:
{code_changes}

–í–µ—Ä–Ω–∏ JSON —Å –Ω–∞–π–¥–µ–Ω–Ω—ã–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
"""


def get_review_prompt(code_changes: str, custom_rules: str = None, language: str = None, framework: str = None) -> str:
    """Generate review prompt based on context"""
    
    if custom_rules:
        return RULES_BASED_PROMPT.format(
            custom_rules=custom_rules,
            language=language or "–Ω–µ —É–∫–∞–∑–∞–Ω",
            framework=framework or "–Ω–µ —É–∫–∞–∑–∞–Ω",
            code_changes=code_changes
        )
    
    return CODE_REVIEW_PROMPT.format(code_changes=code_changes)
